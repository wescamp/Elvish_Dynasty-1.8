#textdomain wesnoth-Elvish_Dynasty
[scenario]

id=EDTier1Coronation
next_scenario=EDTier1Coronation_Epilogue
name = _"Coronation"

map_data="{~add-ons/Elvish_Dynasty/maps/EDCoronation}"
victory_when_enemies_defeated=no
turns=40

#Difficulty level affects enemy gold

	{DEFAULT_SCHEDULE}
    

[side]
	side=1
	controller=human
	team_name=protagonist
	user_team_name= _"Florians"
	id=Aurelia
        name= _ "Aurelia"
        type=Aurelia Elvish Shaman
        canrecruit=yes
        unrenamable=yes
        recruit=Elvish Fighter,Elvish Archer,Elvish Scout,Elvish Peasant,Elvish Shaman
        gold=0
        colour=teal
		
	[village]
	x=25
	y=22
	[/village]
	[village]
	x=27
	y=22
	[/village]
	[village]
	x=29
	y=23
	[/village]
	[village]
	x=28
	y=26
	[/village]
	[village]
	x=26
	y=27
	[/village]
	

[/side]

[side]
	side=2
	controller=ai
	team_name=protagonist
	user_team_name= _"Celadine"
	id=Celadine
        name= _ "Celadine"
        type=Elvish Shyde
        canrecruit=yes
        unrenamable=yes
        recruit=Elvish Shaman,Elvish Lord
        gold=100
        [ai]
            aggression=0.8
            grouping=defensive
            recruitment_pattern=fighter,healer,healer,healer
            passive_leader=yes
            
            #Target the drakes, not Invix
            [target]
        		id=Xeron
        		value=100
    		[/target]
    		[target]
        		id=Rathis
        		value=100
    		[/target]
    		[target]
        		id=Anishai
        		value=100
    		[/target]
    		[target]
        		id=Khilsar
        		value=100
    		[/target]
    		
        [/ai]
	
	[village]
	x=23
	y=23
	[/village]
	[village]
	x=25
	y=26
	[/village]
	
	[unit]
    	type=Elvish Lord
    	id=Cheerleader1
		side=2
		x=24
		y=22
	[/unit]
	[unit]
    	type=Elvish Lord
		side=2
		x=26
		y=26
	[/unit]
	[unit]
    	type=Elvish Lady
    	id=Cheerleader2
		side=2
		x=26
		y=22
	[/unit]
	[unit]
    	type=Elvish Lady
    	id=Cheerleader3
		side=2
		facing=sw
		x=28
		y=25
	[/unit]
	[unit]
    	type=Elvish Peasant
		side=2
		facing=sw
		x=28
		y=22
	[/unit]
	[unit]
    	type=Elvish Peasant
		side=2
		x=24
		y=24
	[/unit]
	
[/side] 

[side]
	side=3
	controller=ai
	team_name=children
	user_team_name= _"Children"
        name= _ "Xeron"
        id=Xeron
        type=Drake Flare
        canrecruit=yes
        unrenamable=yes
        recruit=Drake Glider,Drake Burner,Wolf Rider
        
        #ifdef TOURIST
		gold=60
		#endif
	
		#ifdef EASY
		gold=80
		#endif
	
		#ifdef NORMAL
		gold=100
		#endif
	
		#ifdef HARD
		gold=120
		#endif
        [ai]
            passive_leader=yes
        [/ai]
	
	[village]
	x=3
	y=38
	[/village]
	[village]
	x=6
	y=36
	[/village]
	[village]
	x=9
	y=37
	[/village]
	[village]
	x=13
	y=39
	[/village]
	[village]
	x=15
	y=41
	[/village]
	
[/side] 

[side]
	side=4
	controller=ai
	team_name=children
	user_team_name= _"Children"
        name= _ "Rathis"
        id=Rathis
        type=Goblin Pillager
        canrecruit=yes
        unrenamable=yes
        recruit=Wolf Rider,Goblin Spearman,Drake Burner
        #ifdef TOURIST
		gold=60
		#endif
	
		#ifdef EASY
		gold=80
		#endif
	
		#ifdef NORMAL
		gold=100
		#endif
	
		#ifdef HARD
		gold=120
		#endif
		[ai]
            recruitment_pattern=fighter,fighter,fighter,scout,scout,archer
            passive_leader=yes
        [/ai]
        
	[village]
	x=6
	y=6
	[/village]
	[village]
	x=13
	y=3
	[/village]
	[village]
	x=11
	y=11
	[/village]
	[village]
	x=17
	y=10
	[/village]
	
[/side] 

[side]
	side=5
	controller=ai
	team_name=children
	user_team_name= _"Children"
        name= _ "Anishai"
        id=Anishai
        type=Drake Warrior
        canrecruit=yes
        unrenamable=yes
        recruit=Wolf Rider,Drake Burner,Drake Fighter,Drake Clasher,Drake Glider
        #ifdef TOURIST
		gold=60
		#endif
	
		#ifdef EASY
		gold=80
		#endif
	
		#ifdef NORMAL
		gold=100
		#endif
	
		#ifdef HARD
		gold=120
		#endif
        [ai]
            passive_leader=yes
        [/ai]
        facing=sw
        
	[village]
	x=40
	y=9
	[/village]
	[village]
	x=48
	y=5
	[/village]
	[village]
	x=49
	y=9
	[/village]
	[village]
	x=47
	y=12
	[/village]
	
[/side] 

[side]
	side=6
	controller=ai
	team_name=children
	user_team_name= _"Children"
        name= _ "Khilsar"
        id=Khilsar
        type=Fire Drake
        canrecruit=yes
        unrenamable=yes
        recruit=Drake Burner,Drake Fighter,Drake Glider
        #ifdef TOURIST
		gold=60
		#endif
	
		#ifdef EASY
		gold=80
		#endif
	
		#ifdef NORMAL
		gold=100
		#endif
	
		#ifdef HARD
		gold=120
		#endif
        [ai]
            passive_leader=yes
        [/ai]
        facing=sw
        
	[village]
	x=38
	y=39
	[/village]
	[village]
	x=42
	y=42
	[/village]
	[village]
	x=45
	y=34
	[/village]
	[village]
	x=48
	y=40
	[/village]
	
[/side] 

[side]
	side=7
	controller=ai
	team_name=children
	user_team_name= _"Invix"
        name= _ "Invix"
        id=Invix
        type=Fire Dragon
        canrecruit=yes
        unrenamable=yes
        recruit=Direwolf Rider,Drake Warden,Drake Flameheart,Drake Enforcer,Drake Blademaster,Hurricane Drake,Inferno Drake
        
        #ifdef TOURIST
		gold=20
		#endif
	
		#ifdef EASY
		gold=50
		#endif
	
		#ifdef NORMAL
		gold=80
		#endif
	
		#ifdef HARD
		gold=110
		#endif
		
        income=5
        [ai]
            passive_leader=yes
        [/ai]
	
[/side] 

[event]
	name=prestart
	[objectives]
		side=1
		[objective]
			description= _ "Resist until an opportunity for escape presents itself"
			condition=win
		[/objective]
		[objective]
			description= _ "Note: You will not be held responsible for the deaths of any of Celadine's elves"
			condition=win
		[/objective]
		[objective]
        description= _ "Death of Aurelia"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Bryony"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Celadine"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Kirielle"
        condition=lose
    	[/objective]
    [/objectives]
    
    {PLACE_IMAGE scenery/rock-cairn.png 26 24}
    
    [recall]
    id=Bryony
    x=30
    y=24
    [/recall]
		
	[recall]
    id=Kirielle
    x=30
    y=25
    [/recall]
    
    {MODIFY_UNIT side=1 facing sw}
    
    [store_unit]
			variable=Xeron_store
			kill=yes
			[filter]
			id=Xeron
			[/filter]
	[/store_unit]
	[store_unit]
			variable=Rathis_store
			kill=yes
			[filter]
			id=Rathis
			[/filter]
	[/store_unit]
	[store_unit]
			variable=Anishai_store
			kill=yes
			[filter]
			id=Anishai
			[/filter]
	[/store_unit]
	[store_unit]
			variable=Khilsar_store
			kill=yes
			[filter]
			id=Khilsar
			[/filter]
	[/store_unit]
	[store_unit]
			variable=Invix_store
			kill=yes
			[filter]
			id=Invix
			[/filter]
	[/store_unit]
	
	[set_variable]
		name=invix_spawn
		value=0
	[/set_variable]
	[set_variable]
		name=stone_destroyed
		value=0
	[/set_variable]
	[set_variable]
		name=hurlot_dead
		value=0
	[/set_variable]

[/event]

[event]
	name=start
	
	[message]
		speaker=narrator
		message= _ "Skip the Coronation cutscene?"
				[option]
				message= _ "No"
				[command]
				[fire_event]
				name=coronation
				[/fire_event]
				[/command]
				[/option]
				[option]
				message= _ "Yes"
				[command]
				[fire_event]
				name=skipped_setup
				[/fire_event]
				[/command]
				[/option]	
	[/message]
		
[/event]
		
[event]
	name=coronation
	
	[music]
		name=transience.ogg
		play_once=yes
	[/music]
	[message]
    	speaker=Kirielle
        message= _ "No sign of the Empire yet. That's good news."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Yay! Let's get this party started!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Bryony! The Coronation Ceremony is a very solemn and formal occasion!"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "(Subdued) Oh. I guess that means there won't be a party..."
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "The party happens after the Ceremony."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "(Cheery again) Yay!"
    [/message]
    [music]
		name=elvish-theme.ogg
		immediate=yes
	[/music]
    [message]
    	speaker=Celadine
        message= _ "Greetings. For those of you who don't know me, I am High Priestess Celadine, leader of the Viridian Order. My Order is charged with the sacred duty of honoring our patron goddess Titania. This also includes serving the Florian royal family, as it was the goddess Herself who blessed Floria's first King and gave him the divine mandate to rule. As a direct descendant of that blessed bloodline, Princess Aurelia will now take her place as Floria's rightful Queen!"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "Just five short years ago this land was reeling from the death of our King. The kingdom itself verged on collapse as the foreign invaders attacked."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "But Princess Aurelia rose to the challenge and protected Floria. Even more impressive, she was able to do this despite having no knowledge of her past. For that you have the thanks of every Florian elf."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "Ranger Kirielle, thank you as well for mentoring Aurelia and helping her to recover as best she can from her amnesia."
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "It was nothing."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "Elves from all over Floria have traveled here to witness this rare event. Aurelia, it's traditional that you take some time to seek the counsel of your subjects before the Coronation..."
    [/message]
    [message]
    	speaker=narrator
        message= _ "Several hours pass as various dignitaries give speeches, and well-wishers come to congratulate you. Your mind wanders..."
    [/message]
    [message]
			speaker=narrator
			message= _ "KINGDOM HAPPINESS CHECK
			Current happiness level: $kingdom_happiness of 100."
	[/message]
	[sound]
		name=gold.ogg
	[/sound]
	[gold]
		side=1
		amount=$kingdom_happiness
	[/gold]
	[message]
		speaker=narrator
		image=wesnoth-icon.png
		message= _ "You gained $kingdom_happiness gold worth of gifts!"
	[/message]
    
    [modify_turns]
    current=2
    [/modify_turns]
    
    [message]
    	speaker=Bryony
        message= _ "(Yawn) Is this ever going to end? When does the party start?"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "...And now to the conclusion of the Ceremony."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Yay!!!"
    [/message]
	[message]
    	speaker=Aurelia
        message= _ "(Finally!)"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "Aurelia, you must touch the Ceremony Stone. Only one of Floria's royal blood may touch it and survive. Once your royal lineage is confirmed I will crown you Queen."
    [/message]
    [message]
    	speaker=Aurelia
        message= _ "(Wait, what? If I'm not of royal blood I'll die from touching this stone?! Kirielle never mentioned anything about this!)"
    [/message]
    
    [fire_event]
		name=stone_touch
	[/fire_event]
    
[/event]

[event]
	name=stone_touch
	first_time_only=no
	
	[message]
		id=Aurelia
		message= _ "(What to do?)"
				[option]
				message= _ "(Take a deep breath and touch the stone)."
				[command]
				
				[fire_event]
				name=stone_touched
				[/fire_event]
				[/command]
				[/option]
				
				[option]
				message= _ "I'm not touching that stone. It could kill me!"
				[command]
				[message]
    			speaker=Kirielle
        		message= _ "You've come too far to turn back now."
    			[/message]
    			[message]
    			speaker=Bryony
        		message= _ "I have faith in you, Princess!"
    			[/message]
    			[fire_event]
				name=stone_touch
				[/fire_event]
				[/command]
				[/option]
				
				[option]
				message= _ "I never wanted to be a monarch. I abdicate. [End game]"
				[command]
				
				[music]
        		name=sad.ogg
        		play_once=yes
    			[/music]
    	
				[message]
    			speaker=Bryony
        		message= _ "Aurelia, no!"
    			[/message]
    			
    			{TELEPORT_UNIT (
    			id=Aurelia
    			) 8 40}
    			    
    			[message]
    			speaker=Aurelia
        		message= _ "(Despite disowning your crown you manage to live the next few years peacefully. Then, suddenly you're struck by a deadly and mysterious disease.)"
    			[/message]
    			[message]
    			speaker=Aurelia
        		message= _ "(Often in the last moments of life the truth is revealed. You realize your illness is a result of your heritage...but since you've abdicated your throne there is no one to help you find the answers you'll need to survive.)"
    			[/message]
    			[message]
    			speaker=Aurelia
        		message= _ "(Destiny can be a cruel mistress you realize. And then you die.)"
    			[/message]
    			[message]
    			speaker=narrator
        		message= _ "RESTARTING..."
    			[/message]
    			
    			#[gold]
				#	side=1
				#	amount=-$kingdom_happiness
				#[/gold]
				#The player earns 7 income on this turn so this needs to be taken away as well
				#[gold]
				#	side=1
				#	amount=-7
				#[/gold]
    			#[endlevel]
				#	result=victory
				#	next_scenario=EDTier1Coronation
				#	carryover_percentage=100
				#	bonus=no
				#	carryover_report=no
            	#	linger_mode=no
				#[/endlevel]
				
				{TELEPORT_UNIT (
    			id=Aurelia
    			) 29 25}
    			
    			{MODIFY_UNIT id=Aurelia facing sw}
    			
    			[redraw]
    			[/redraw]
    			
				[fire_event]
				name=stone_touch
				[/fire_event]
				
				[/command]
				[/option]
				
		[/message]
[/event]

[event]
	name=stone_touched

	[store_unit]
			variable=aurelia_store
			kill=yes
			[filter]
			id=Aurelia
			[/filter]
	[/store_unit]
	[move_unit_fake]
	type=$aurelia_store.type
	x=29,28,27,26
	y=25,24,24,24
	[/move_unit_fake]
	
	[unstore_unit]
	variable=aurelia_store
	x=26
	y=24
	[/unstore_unit]
	
    [message]
    	speaker=Aurelia
        message= _ "(You touch the stone. It feels cool to the touch. It seems to be just an ordinary slab of rock...)"
    [/message]
    [sound]
		name=flame-big.ogg
	[/sound]
	[sound]
		name=lightning.ogg
	[/sound]
    [colour_adjust]
		red=200
		green=50
		blue=50
		[/colour_adjust]
		[delay]
		time=100
		[/delay]
		[colour_adjust]
		red=0
		green=0
		blue=0
	[/colour_adjust]
	
	[music]
		name=silence.ogg
		immediate=yes
	[/music]
	
    [message]
    	speaker=Aurelia
        message= _ "(Suddenly there's a blinding flash of light! You feel as if someone is hitting your head repeatedly with a hammer!)"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "PRINCESS!!!!!"
    [/message]
    [sound]
		name=lightning.ogg
	[/sound]
    [colour_adjust]
		red=100
		green=100
		blue=100
		[/colour_adjust]
		[delay]
		time=2000
		[/delay]
		[colour_adjust]
		red=0
		green=0
		blue=0
	[/colour_adjust]
    [message]
    	speaker=Aurelia
        message= _ "(You black out from the pain.)"
    [/message]
    
    [modify_turns]
    current=5
    [/modify_turns]
    
    [object]
        silent=yes
       
        [filter]
            id=Aurelia
        [/filter]
       
        [effect]
            apply_to=hitpoints
			increase=-20
        [/effect]
    [/object]
    
    [sound]
		name=ambient/night.ogg
	[/sound]
	
	
    [message]
    	speaker=Aurelia
        message= _ "(When you wake up there are stars in the sky. You feel terrible.)"
    [/message]
    [music]
		name=revelation.ogg
		immediate=yes
	[/music]
    [message]
    	speaker=Bryony
        message= _ "(Sobbing) Oh thank the Goddess! I thought we'd lost you!"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "It's fortunate that I was here to heal you from the brink of death."
    [/message]
    [message]
    	speaker=Aurelia
        message= _ "What happened?"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "I...am unsure. I've never heard of anything like this happening in any previous Coronation Ceremony. Most curious..."
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Nevertheless, she survived touching the stone. If she wasn't of the royal bloodline she would've been incinerated instantly."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "Yes, the Ceremony is accomplished. Aurelia is our anointed monarch. I will now give you your father's crown."
    [/message]
    [message]
    	speaker=Aurelia
        message= _ "(You receive the Emerald Crown of Floria!)"
    [/message]
    [message]
    	speaker=Celadine
        message= _ "All hail Queen Aurelia!"
    [/message]
    [message]
    	speaker=Cheerleader1
        message= _ "Hail the new Queen!"
    [/message]
    [message]
    	speaker=Cheerleader2
        message= _ "Long live the Queen!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "We've lingered here too long. We've got company."
    [/message]
    
    [unit]
    	type=Lancer
    	id=Hurlot
    	name= _ "Hurlot"
		[modifications]
		{TRAIT_LOYAL}
		{TRAIT_QUICK}
		[/modifications]
		side=1
		x=23
		y=20
	[/unit]
	[object]
        silent=yes
       
        [filter]
            id=Hurlot
        [/filter]
       
        [effect]
            apply_to=hitpoints
			increase=-40
        [/effect]
    [/object]
	
	
	[message]
    	speaker=Hurlot
        message= _ "(A badly wounded and breathless human riding a wild-eyed horse has stumbled upon your location)"
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "Hurry! (Gasp) No time! (Pant) The Princess! The Children! No time! THE CHILDREN!!!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Hold human. What's going on here?"
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "Everybody...dead! EVERYONE!!! The Children! They...they're coming! RUN!"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Slow down! What are you trying to say?"
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "(He composes himself and catches his breath) I'm...the last. The only survivor. We were a mighty army of bounty hunters out to slay the dragon-god Invix and rescue the Princess."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Well I don't know anything about a dragon-god but Princess Aurelia is safe! She's actually Queen Aurelia now."
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "We came to save Princess Silverdale of the Empire of Man. She was kidnapped by drakes! Dragon-kin! The Children of Invix!"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Why would drakes kidnap a human princess?"
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "The drakes worship the dragon Invix as a god! Invix is a cruel and capricious tyrant that hunts intelligent races for nothing more than sport! They say he also craves virgin sacrifices."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "Oh dear! We must save this woman!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "We must do nothing of the kind! It's a human problem. It doesn't concern us. In fact I think it's well past time that we left this place."
    [/message]
    [message]
    	speaker=Hurlot
        message= _ "The Emperor is desperate to save his only child. He's offered the greatest treasure in the land to any man who can slay Invix and rescue ...OH GODS! THEY'RE HERE!!!"
    [/message]
    
    [music]
		name=vengeful.ogg
		immediate=yes
	[/music]
	
    [unstore_unit]
	variable=Xeron_store
	[/unstore_unit]
	[unstore_unit]
	variable=Rathis_store
	[/unstore_unit]
	[unstore_unit]
	variable=Anishai_store
	[/unstore_unit]
	[unstore_unit]
	variable=Khilsar_store
	[/unstore_unit]
	
	[message]
    	speaker=Anishai
        message= _ "Elves! Fall down and accept Invix as your new god!"
    [/message]
	[message]
    	speaker=Rathis
        message= _ "Invix gave Life to the drakes, but you don't need to be of reptilian blood to be one of His Children! All that is required is a willingness to serve!"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "No! You can't bully us into submission! And hand over the Princess you kidnapped too!"
    [/message]
    [message]
    	speaker=Rathis
        message= _ "This is your last chance. Once we were a weak goblin tribe on the verge of extinction! Surrounded by enemies intent on our destruction! But Invix showed us how to be strong again! Now our enemies are dead and our name is feared throughout the land! No one survives being hunted by the Children of Invix. No one."
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "I've heard of this Invix fellow. He's obsessed with the thrill of the hunt. His entire religion focuses on hunting lesser races for sport. His uses his worshippers as hunting assistants. But kidnapping a human princess? It...just isn't his style. And that bit about her being a sacrifice? I don't believe it for one second.  Invix is only interested in a good hunt...there's no sport in killing a helpless princess. "
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "And I'm sure it's no coincidence that the Children of Invix just happened to be in this area when it was time for your Coronation Ceremony. Be careful Aurelia, not all is as it seems here..."
    [/message]
    
    [redraw]
    [/redraw]
    [message]
    	speaker=Xeron
        message= _ "Invix! Grant my hunters the strength of the lion, so that they may maul our prey!"
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Xeron Unity Magic: 
					Unity Magic Level 1 Activated!
					Xeron has given all his units +1 damage to melee attacks!"
    [/message]
    
    [redraw]
    [/redraw]
    [message]
    	speaker=Rathis
        message= _ "Invix! Grant my hunters the resilience of the bear, so that they may outlast our prey!"
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Rathis Unity Magic: 
					Unity Magic Level 1 Activated!
					Rathis has given all his units +3 hit points!"
    [/message]
    
    [redraw]
    [/redraw]
    [message]
    	speaker=Anishai
        message= _ "Invix! Grant my hunters the quickness of the cheetah, so that they may outrun our prey!"
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Anishai Unity Magic: 
					Unity Magic Level 1 Activated!
					Anishai has given all her units +1 movement!"
    [/message]
    
    [redraw]
    [/redraw]
    [message]
    	speaker=Khilsar
        message= _ "Invix! Grant my hunters the accuracy of the eagle, so that they may strike down our prey!"
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Khilsar Unity Magic: 
					Unity Magic Level 1 Activated!
					Khilsar has given all his units +1 damage to ranged attacks!"
    [/message]
    
    [redraw]
    [/redraw]
    [message]
    	speaker=Hurlot
        message= _ "We're surrounded! They'll kill us for certain!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "So the Children of Invix like unity magic, do they? I'll give them a taste of their own medicine!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Forests of this land, please shelter your watchful protectors!"
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Kirielle Unity Magic: 
					Unity Magic Level 1 Activated!
					Kirielle has given all your units the ambush ability!"
    [/message]
    
    #This takes care of Hurlot and Aurelia.
	#The rest of Kirielle's unity magic is in the unity magic section below
	
	[fire_event]
		name=kirielle_initial_unity
	[/fire_event]
    
    
    [message]
    	speaker=Celadine
        message= _ "The Viridian Order is at your service, my Queen."
    [/message]
    [message]
		speaker=narrator
		image=units/elves-wood/shaman.png
		message= _ "You can now recruit Elvish Shamans!"
	[/message]
	[message]
    	speaker=Bryony
        message= _ "Things look grim. But I'll fight by your side until the end, Aurelia!"
    [/message]
    
    [kill]
    id=Cheerleader2
    [/kill]
    
    [kill]
    id=Cheerleader3
    [/kill]
    
[/event]

###############################
#####SKIPPING THE CUTSCENE#####
###############################

[event]
	name=skipped_setup
	
	[modify_turns]
    current=5
    [/modify_turns]
    
    [music]
		name=vengeful.ogg
	[/music]
	
    [object]
        silent=yes
       
        [filter]
            id=Aurelia
        [/filter]
       
        [effect]
            apply_to=hitpoints
			increase=-20
        [/effect]
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
    [unit]
    	type=Lancer
    	id=Hurlot
    	name= _ "Hurlot"
		[modifications]
		{TRAIT_LOYAL}
		{TRAIT_QUICK}
		[/modifications]
		side=1
		x=23
		y=20
	[/unit]
	
	[object]
        silent=yes
       
        [filter]
            id=Hurlot
        [/filter]
       
        [effect]
            apply_to=hitpoints
			increase=-40
        [/effect]
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
    [unstore_unit]
	variable=Xeron_store
	[/unstore_unit]
	[unstore_unit]
	variable=Rathis_store
	[/unstore_unit]
	[unstore_unit]
	variable=Anishai_store
	[/unstore_unit]
	[unstore_unit]
	variable=Khilsar_store
	[/unstore_unit]
	
	[message]
			speaker=narrator
			message= _ "KINGDOM HAPPINESS CHECK
			Current happiness level: $kingdom_happiness of 100."
	[/message]
	[sound]
		name=gold.ogg
	[/sound]
	[gold]
		side=1
		amount=$kingdom_happiness
	[/gold]
	[message]
		speaker=narrator
		image=wesnoth-icon.png
		message= _ "You gained $kingdom_happiness gold worth of gifts!"
	[/message]
	
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Xeron Unity Magic: 
					Unity Magic Level 1 Activated!
					Xeron has given all his units +1 damage to melee attacks!"
    [/message]
    
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Rathis Unity Magic: 
					Unity Magic Level 1 Activated!
					Rathis has given all his units +3 hit points!"
    [/message]
    
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Anishai Unity Magic: 
					Unity Magic Level 1 Activated!
					Anishai has given all her units +1 movement!"
    [/message]
    
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Khilsar Unity Magic: 
					Unity Magic Level 1 Activated!
					Khilsar has given all his units +1 damage to ranged attacks!"
    [/message]
    
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Kirielle Unity Magic: 
					Unity Magic Level 1 Activated!
					Kirielle has given all your units the ambush ability!"
    [/message]

	
	{TELEPORT_UNIT (
    		id=Aurelia
    	) 26 24}
    	
    [kill]
    id=Cheerleader2
    [/kill]
    
    [kill]
    id=Cheerleader3
    [/kill]
	
[/event]
	
	
#######################
#####INVIX ARRIVES#####
#######################

[event]
	name=turn 12
	
	 [message]
    	speaker=Celadine
        message= _ "I've lived many centuries. But I've never seen or heard of anything like this. The Children of Invix attack with suicidal fanaticism...They refuse to surrender, they refuse to retreat! How can such hatred exist in this world! How can there be such disrespect for the sanctity of Life? Titania preserve us!"
    [/message]
    [message]
    	speaker=Bryony
        message= _ "This does look really bad! I'm not sure how it could get much worse!"
    [/message]
    
	[unstore_unit]
	variable=Invix_store
	find_vacant=yes
	[/unstore_unit]
	
	#Give Invix enough hit points so that no one can kill him in one attack
    [object]
        silent=yes
       
        [filter]
            id=Invix
        [/filter]
       
        [effect]
            	apply_to=hitpoints
            	increase_total=100
            	increase=100
        [/effect]
    [/object]

	[set_variable]
		name=invix_spawn
		random=1,2,3
	[/set_variable]
	
	[if]
		[variable]
			name=invix_spawn
			numerical_equals=2
		[/variable]
		[then]
		{TELEPORT_UNIT (
    		id=Invix
    	) 42 5}
    	{MODIFY_UNIT id=Invix facing sw}
    	[/then]
    [/if]
    [if]
		[variable]
			name=invix_spawn
			numerical_equals=3
		[/variable]
		[then]
		{TELEPORT_UNIT (
    		id=Invix
    	) 49 36}
    	{MODIFY_UNIT id=Invix facing sw}
    	[/then]
    [/if]
    
    [music]
		name=northerners.ogg
		immediate=yes
	[/music]
		
    [message]
    	speaker=Invix
        message= _ "(Suddenly a creature from your worst nightmares descends from the heavens! A collective scream of fear and horror sounds from the surviving elves.)"
    [/message]
    [message]
    	speaker=Invix
        message= _ "(This could only be the creature that calls itself a god...Invix. The dragon speaks in a booming voice that shakes the heavens.)"
    [/message]
    [message]
    	speaker=Invix
        message= _ "CHILDREN, OH MY CHILDREN! WHAT PREY HAVE YOU RUN TO GROUND FOR YOUR MASTER TODAY?"
    [/message]
    [message]
    	speaker=Xeron
        message= _ "Pointy-eared tree-dwellers!"
    [/message]
    [message]
    	speaker=Rathis
        message= _ "Vermin of the forest!"
    [/message]
    [message]
    	speaker=Anishai
        message= _ "Infidels of that whore, Titania!"
    [/message]
    [message]
    	speaker=Khilsar
        message= _ "Tasty meat treats!"
    [/message]
    [message]
    	speaker=Invix
        message= _ "THE HORNS OF THE HUNTERS. THE CRIES OF THE WOUNDED. THE STENCH OF FEAR AND BLOOD. THE RATTLE OF A DYING CREATURE'S FINAL BREATH. THE HUNT...SAVOR IT, TASTE IT, FEEL IT!"
    [/message]
    [message]
    	speaker=Invix
        message= _ "DO YOU THINK THE HEATHENS WILL UNDERTSTAND BEFORE THE HUNT TAKES THEM? CAN THEY KNOW OF ITS GLORY? THEY WILL. IN THAT LAST, FURTIVE GLANCE BEFORE THEIR EYES GLAZE OVER IN DEATH, THEY'LL SEE IT. THAT FINAL EPIPHANY BEFORE THE ENDLESS SLEEP. THEY WILL REVEL IN THE GLORY OF THE HUNT AS WE DO."
    [/message]
    [message]
    	speaker=Bryony
        message= _ "I hunt to put food on the table for the hungry...but you...you...how can you be so cruel?!"
    [/message]
    [message]
    	speaker=Invix
        message= _ "A FELLOW HUNTRESS AMONG INFIDELS? CAN IT BE? THERE IS NO JOY GREATER THAN THAT OF THE CHASE AND THE KILL."
    [/message]
    [sound]
		name=magic-dark.ogg
	[/sound]
    [message]
    	speaker=narrator
        message= _ "Invix Unity Magic: 
					Unity Magic Level 2 Activated!
					Invix has given all his Children +6 hit points!"
    [/message]
    
    #This takes care of all pre-existing Children
    #The recruit event is with the rest of the Children's unity magic
    [store_unit]
    [filter]
        side=3,4,5,6
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            	apply_to=hitpoints
            	increase_total=6
            	increase=6
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
    
    [message]
    	speaker=Aurelia
        message= _ "This is looking grim."
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Aurelia, use your magic to drain the power out of the Coronation Stone. Only you can touch it."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "But...that will destroy the sacred Stone!"
    [/message]
    [message]
    	speaker=Kirielle
        message= _ "Better that than we all die here."
    [/message]
    [message]
    	speaker=Celadine
        message= _ "...Titania forgive us, but you are right."
    [/message]
    
    [objectives]
		side=1
		[objective]
			description= _ "Move Aurelia to the Coronation Stone"
			condition=win
		[/objective]
		[objective]
			description= _ "Note: You will not be held responsible for the deaths of any of Celadine's elves"
			condition=win
		[/objective]
		[objective]
        description= _ "Death of Aurelia"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Bryony"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Celadine"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Kirielle"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Turns run out"
        condition=lose
        [/objective]
    [/objectives]
    
    [music]
		name=siege_of_laurelmor.ogg
	[/music]
	
[/event]
	
#################################
#####CORONATION STONE EVENTS#####
#################################

[event]
	name=moveto
	first_time_only=no
		[filter]
		x=26
		y=24
		[and]
		side=3
		[or]
		side=4
		[/or]
		[or]
		side=5
		[/or]
		[or]
		side=6
		[/or]
		[or]
		side=7
		[/or]
		[/and]
		[/filter]
		
		[if]
		[variable]
			name=stone_destroyed
			numerical_equals=0
		[/variable]
		[then]
		
		[sound]
			name=lightning.ogg
		[/sound]
		
		[message]
		speaker=narrator
		message= _ "One of the Children has touched the Coronation Stone. They are instantly incinerated!"
		image=scenery/scenery/rock-cairn.png
		[/message]
		[kill]
		x=26
		y=24
		animate=yes
		fire_event=yes
		[/kill]
		[/then]
		[/if]
		
[/event]

[event]
	name=moveto
	first_time_only=no
		[filter]
		x=26
		y=24
		[and]
		id=Aurelia
		[/and]
		[/filter]
		
		[if]
		[variable]
			name=stone_destroyed
			numerical_equals=0
		[/variable]
		[and]
		[variable]
			name=invix_spawn
			greater_than=0
		[/variable]
		[/and]
		[then]
		
		[message]
    	speaker=Aurelia
        message= _ "(Reluctantly you touch the Coronation Stone again.)"
    	[/message]
    	[message]
    	speaker=Aurelia
        message= _ "(It hurts. A LOT. You grit your teeth and draw the magic out of the ancient rock.)"
    	[/message]
		
		[sound]
		name=lightning.ogg
		[/sound]
    	[colour_adjust]
		red=100
		green=100
		blue=100
		[/colour_adjust]
		[delay]
		time=2000
		[/delay]
		[colour_adjust]
		red=0
		green=0
		blue=0
		[/colour_adjust]
		
		[object]
        silent=yes
       
        [filter]
            id=Aurelia
        [/filter]
       
        [effect]
            apply_to=hitpoints
			increase=-20
        [/effect]
    	[/object]
    	
    	[removeitem]
		x,y=26,24
		[/removeitem]
		{PLACE_IMAGE scenery/rubble.png 26 24}
		[sound]
		name=cave-in.ogg
		[/sound]
    	
    	[message]
    	speaker=Aurelia
        message= _ "(You are infused with magical energy! The air crackles with electricity around you. You've never felt so...vibrant. Everything seems brighter and clearer.)"
    	[/message]
    	[message]
    	speaker=Kirielle
        message= _ "Tempting as it may be, don't waste any of your new magic on Invix's Children. You've got enough energy for maybe one concentrated attack on the dragon himself. Kill Invix, and his Children may rout."
    	[/message]
    	
    	[objectives]
		side=1
		[objective]
			description= _ "Attack Invix with Aurelia"
			condition=win
		[/objective]
		[objective]
			description= _ "Note: You will not be held responsible for the deaths of any of Celadine's elves"
			condition=win
		[/objective]
		[objective]
        description= _ "Death of Aurelia"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Bryony"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Celadine"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Death of Kirielle"
        condition=lose
    	[/objective]
    	[objective]
        description= _ "Turns run out"
        condition=lose
        [/objective]
   	    [/objectives]
   	    
   	    [set_variable]
		name=stone_destroyed
		value=1
		[/set_variable]
    	
		[/then]
		[/if]
		
[/event]


############################
#####ATTACK INVIX EVENT#####
############################

		[event]
			name=attack
				[filter]
					id=Aurelia
				[/filter]
				[filter_second]
					id=Invix
				[/filter_second]
				
				[if]
					[variable]
					name=stone_destroyed
					numerical_equals=1
					[/variable]
				[then]
				
			[message]
				id=Aurelia
				message= _ "(You channel your entire reservoir of magic into one immensely destructive spell.)"
			[/message]
			
			[sound]
			name=flame-big.ogg
			[/sound]
			[sound]
			name=lightning.ogg
			[/sound]
   			[colour_adjust]
			red=200
			green=50
			blue=50
			[/colour_adjust]
			[delay]
			time=1000
			[/delay]
			[colour_adjust]
			red=0
			green=0
			blue=0
			[/colour_adjust]
        
			[message]
				id=Invix
				message= _ "(Invix explodes in a burst of towering flame that reaches into the heavens!!!)"
			[/message]
			
			[kill]
			id=Invix
			animate=yes
			[/kill]
			
			[message]
				id=Xeron
				message= _ "(Incredulous) You...you killed God!!!"
			[/message]
			[message]
				id=Rathis
				message= _ "Impossible! Invix cannot be killed!"
			[/message]
			[message]
				id=Anishai
				message= _ "No! What will become of the Children?!"
			[/message]
			[message]
				id=Khilsar
				message= _ "This isn't happening! It can't be!"
			[/message]
			[message]
				id=Kirielle
				message= _ "Let's get the hell out of here while they're distracted!"
			[/message]
			
				[if]
					[variable]
					name=hurlot_dead
					numerical_equals=0
					[/variable]
				[then]
					[message]
						id=Hurlot
						message= _ "Thank you. Without your help I'm sure the Children would've killed me. At least now my dead comrades have been avenged."
					[/message]
					[message]
							id=Hurlot
							message= _ "I need to return to the human lands, but please take this gold as a token of my gratitude."
					[/message]
					[sound]
						name=gold.ogg
					[/sound]
					[gold]
						side=1
						amount=30
					[/gold]
					[kill]
						id=Hurlot
						animate=yes
					[/kill]
					[message]
						speaker=narrator
						image=wesnoth-icon.png
						message= _ "You gained 30 gold!"
					[/message]
				[/then]
				[/if]
			
			{CLEAR_VARIABLE Xeron_store}
			{CLEAR_VARIABLE Rathis_store}
			{CLEAR_VARIABLE Anishai_store}
			{CLEAR_VARIABLE Khilsar_store}
			{CLEAR_VARIABLE Invix_store}
			{CLEAR_VARIABLE stone_destroyed}
			{CLEAR_VARIABLE hurlot_dead}
			{CLEAR_VARIABLE invix_spawn}
    
    		#Note that in the unity magic util we make sure that Celadine is NOT debuffed
			{MODIFY_UNIT id=Celadine side 1}
			
   		    [endlevel]
			result=victory
			#carryover_percentage=100
			{NEW_GOLD_CARRYOVER 40}
			next_scenario=EDTier1Coronation_Epilogue
			[/endlevel]
	
			[/then]
			[/if]
			
			
		[/event]
		
		[event]
        name=attack_end
        first_time_only=no
        [filter]
            side=1,2
        [/filter]
        [filter_second]
            id=Invix
        [/filter_second]
        [colour_adjust]
            red=100
            green=100
            blue=100
        [/colour_adjust]
        [delay]
            time=10
        [/delay]
        [colour_adjust]
            red=0
            green=0
            blue=0
        [/colour_adjust]
        [sound]
            name=heal.wav
        [/sound]
        [object]
            [filter]
                id=Invix
            [/filter]
            silent=yes
            [effect]
                apply_to=hitpoints
                heal_full=yes
            [/effect]
        [/object]
        [message]
            id=Invix
            message= _ "(Invix's wounds immediately heal themselves! Perhaps he really is a god?)"
        [/message]
        [message]
            id=Kirielle
            message= _ "Only the power of the Coronation Stone might be able to breach the dragon's defenses."
        [/message]
    [/event]
    
    [event]
        name=attack_end
        first_time_only=no
        [filter]
            id=Invix
        [/filter]
        [filter_second]
            side=1,2
        [/filter_second]
        [colour_adjust]
            red=100
            green=100
            blue=100
        [/colour_adjust]
        [delay]
            time=10
        [/delay]
        [colour_adjust]
            red=0
            green=0
            blue=0
        [/colour_adjust]
        [sound]
            name=heal.wav
        [/sound]
        [object]
            [filter]
                id=Invix
            [/filter]
            silent=yes
            [effect]
                apply_to=hitpoints
                heal_full=yes
            [/effect]
        [/object]
        [message]
            id=Invix
            message= _ "(Invix's wounds immediately heal themselves! Perhaps he really is a god?)"
        [/message]
        [message]
            id=Kirielle
            message= _ "Only the power of the Coronation Stone might be able to breach the dragon's defenses."
        [/message]
    [/event]




################################################
#####UNITY MAGIC, TIME UP, AND DEATH EVENTS#####
################################################

#Xeron's unity magic
[event]
	name=recruit
	first_time_only=no
	
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=3
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=1
        [/effect]
    [/object]
    
[/event]

[event]
        name=last breath
        [filter]
            id=Xeron
        [/filter]
        [message]
            speaker=Xeron
            message= _ "Blood for Invix!"
        [/message]
        [message]
            speaker=Xeron
            message= _ "(The creature's unity magic has dissipated.)"
        [/message]
        
        [store_unit]
    [filter]
        side=3
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=-1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

[/event]

#Rathis's unity magic
[event]
	name=recruit
	first_time_only=no
	
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=4
        [/filter]
       
        [effect]
            	apply_to=hitpoints
            	increase_total=3
            	increase=3
        [/effect]
    [/object]

[/event]

[event]
        name=last breath
        [filter]
            id=Rathis
        [/filter]
        [message]
            speaker=Rathis
            message= _ "Glory to the Children!"
        [/message]
        [message]
            speaker=Rathis
            message= _ "(The goblin's unity magic has dissipated.)"
        [/message]
        
        [store_unit]
    [filter]
        side=4
        #Need to specify not Rathis here, otherwise he won't die if the AI kills him
        [not]
        id=Rathis
        [/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            	apply_to=hitpoints
            	increase_total=-3
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

[/event]

#Anishai's unity magic
[event]
	name=recruit
	first_time_only=no
	
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=5
        [/filter]
       
        [effect]
            apply_to=movement
			increase=1
        [/effect]
    [/object]
    
[/event]

[event]
        name=last breath
        [filter]
            id=Anishai
        [/filter]
        [message]
            speaker=Anishai
            message= _ "Invix will avenge me!"
        [/message]
        [message]
            speaker=Anishai
            message= _ "(The creature's unity magic has dissipated.)"
        [/message]
        
        [store_unit]
    [filter]
        side=5
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=movement
			increase=-1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

[/event]

#Khilsar's unity magic
[event]
	name=recruit
	first_time_only=no
	
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=6
        [/filter]
       
        [effect]
            apply_to=attack
			range=ranged
			increase_damage=1
        [/effect]
    [/object]
    
[/event]

[event]
        name=last breath
        [filter]
            id=Khilsar
        [/filter]
        [message]
            speaker=Khilsar
            message= _ "Death to the enemies of the Children!"
        [/message]
        [message]
            speaker=Khilsar
            message= _ "(The creature's unity magic has dissipated.)"
        [/message]
        
        [store_unit]
    [filter]
        side=6
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=ranged
			increase_damage=-1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

[/event]

#Invix's unity magic
#This is a special one time exception to the rule that unity magic can only affect one side
[event]
	name=recruit
	first_time_only=no
	
	[if]
		[variable]
			name=invix_spawn
			greater_than=0
		[/variable]
	[then]
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=3,4,5,6,7
        [/filter]
       
        [effect]
            	apply_to=hitpoints
            	increase_total=6
            	increase=6
        [/effect]
    [/object]
    
    [/then]
    [/if]
    
[/event]

#Aurelia's unity magic must be defined manually because we start on turn 5
[event]
	name=turn 5
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=95
		[/variable]
		[then]
		[sound]
		name=magic-dark.ogg
		[/sound]
		[message]
			speaker=narrator
			message= _ "Aurelia Unity Magic: 
						If happiness is >50, then +1 melee damage.
						If happiness is >95, then +2 melee damage.
						Current Aurelia happiness is $aurelia_happiness!
						Unity Magic Level 2 Activated!"
		[/message]
		[message]
			id=Aurelia
			message= _ "Draw strength from me and we'll be unstoppable!"
		[/message]
		[message]
			speaker=narrator
			message= _ "You give all other units in your army +2 damage to melee attacks!"
		[/message]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Aurelia
    	[/not]
    	#Exclude Bryony,Kirielle because when this event triggers they will have already been recalled
    	#Resulting in them being buffed twice which we don't want
    	[not]
    	id=Bryony
    	[/not]
    	[not]
    	id=Kirielle
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=2
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=aurelia_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
		[sound]
		name=magic-dark.ogg
		[/sound]
		[message]
			speaker=narrator
			message= _ "Aurelia Unity Magic: 
						If happiness is >50, then +1 melee damage.
						If happiness is >95, then +2 melee damage.
						Current Aurelia happiness is $aurelia_happiness!
						Unity Magic Level 1 Activated!"
		[/message]
		[message]
			id=Aurelia
			message= _ "Draw strength from me and we'll strike down our enemies!"
		[/message]
		[message]
			speaker=narrator
			message= _ "You give all other units in your army +1 damage to melee attacks!"
		[/message]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Aurelia
    	[/not]
    	#Exclude Bryony,Kirielle because when this event triggers they will have already been recalled
    	#Resulting in them being buffed twice which we don't want
    	[not]
    	id=Bryony
    	[/not]
    	[not]
    	id=Kirielle
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=aurelia_happiness 
		less_than_equal_to=50
		[/variable]

		[then]
		[message]
			speaker=narrator
			message= _ "Aurelia Unity Magic: 
						If happiness is >50, then +1 melee damage.
						If happiness is >95, then +2 melee damage.
						Current Aurelia happiness is $aurelia_happiness!
						Increase happiness levels to activate unity magic!"
		[/message]
		

		[/then]
	[/if]


		
[/event]	

[event]
	name=recruit
	first_time_only=no
	
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=95
		[/variable]
		[then]
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=2
        [/effect]
    [/object]

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=aurelia_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=1
        [/effect]
    [/object]

		[/then]
	[/if]


[/event]	

[event]
	name=recall
	first_time_only=no
	
	[filter]
       [not]
           find_in=units_already_melee_buffed
       [/not]
    [/filter]
    
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=95
		[/variable]
	[then]
    
    [unstore_unit] 
    	variable=unit 
    	find_vacant=no 
    [/unstore_unit]
    
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=2
        [/effect]
    [/object]
    
    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
       
        variable=units_already_melee_buffed
        mode=append
        kill=no
    [/store_unit]

 	[/then]
    [/if]
    
    [if]
		[variable] 
		name=aurelia_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=aurelia_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

	[then]
    
    [unstore_unit] 
    	variable=unit 
    	find_vacant=no 
    [/unstore_unit]
    
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=1
        [/effect]
    [/object]
    
    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
       
        variable=units_already_melee_buffed
        mode=append
        kill=no
    [/store_unit]

	[/then]
	[/if]

    
[/event]


[event]
	name=victory
	
#This is for units that were recalled and affected by unity magic but...
#...the player chose to undo the recall, and the (now-buffed) unit got left on the recall roster.
#This recalls all the effected units at the scenario end so that the victory event debuffs can take place.

#Two problems: recalling from an array in a victory event crashes wesnoth. Game engine bug???
#One solution would be to buff everyone on the recall roster at level start, then debuff everyone on the roster at the victory event. BUT...
#Using x,y=recall,recall I cannot manipulate stats of units on the recall roster in the pregame.
#I'm sure it's a problem with the filter, as I can manipulate the stats for specific units...

#The following code is a hackey solution, but it seems to work. Edit: No it doesn't.
#We check each unit in the array to see if it's in play. 
#If it isn't in play then we unstore it, so it can be affected by the victory event debuff.
#Then we kill all units in the array in the recall roster to prevent a problem with duplicate units.

#The below code doesn't work. If both Aurelia and Bryony unity magic is activated it creates a problem...
#...in which the quick-buffed units are double debuffed for some reason.

#Also, units that were recalled and then killed will still be unstored at the victory event.
#This could be fixed by creating yet another array to track units that were recalled and then killed.
#Then when we do the unstore we could make sure that only living units were unstored.
#But this is moot until the above problem can be fixed.

#{FOREACH units_already_melee_buffed a}
#[if]
#	[have_unit]
#		id=$units_already_melee_buffed[$a].id
#	[/have_unit]
	
#	[then]
		#Do nothing
#	[/then]
#	[else]
#		[unstore_unit]
#			variable=units_already_melee_buffed[$a]
#			find_vacant=yes
#		[/unstore_unit]

#	[/else]
	
#[/if]
#{NEXT a}

#[kill]
#x,y=recall,recall
#[and]
#find_in=units_already_melee_buffed
#[/and]
#[/kill]



	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=95
		[/variable]
		[then]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Aurelia
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=-2
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
{CLEAR_VARIABLE units_already_melee_buffed}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=aurelia_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=aurelia_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Aurelia
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=attack
			range=melee
			increase_damage=-1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
{CLEAR_VARIABLE units_already_melee_buffed}

		[/then]
	[/if]
	
    
[/event]


#Bryony's unity magic must be defined manually because we start on turn 5
[event]
	name=turn 5
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=95
		[/variable]
		[then]
		[sound]
		name=magic-dark.ogg
		[/sound]
		[message]
			speaker=narrator
			message= _ "Bryony Unity Magic: 
						If happiness is >50, then +1 move.
						If happiness is >95, then +2 move.
						Current Bryony happiness is $bryony_happiness!
						Unity Magic Level 2 Activated!"
		[/message]
		[message]
			id=Bryony
			message= _ "Let's move like the wind in a hurricane!"
		[/message]
		[message]
			speaker=narrator
			message= _ "Bryony gives all other units in your army +2 move!"
		[/message]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Bryony
    	[/not]
    	#Exclude Kirielle because when this event triggers she will have already been recalled
    	#Resulting in her being buffed twice which we don't want
    	[not]
    	id=Kirielle
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=movement
            increase=2
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=bryony_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
		[sound]
		name=magic-dark.ogg
		[/sound]
		[message]
			speaker=narrator
			message= _ "Bryony Unity Magic: 
						If happiness is >50, then +1 move.
						If happiness is >95, then +2 move.
						Current Bryony happiness is $bryony_happiness!
						Unity Magic Level 1 Activated!"
		[/message]
		[message]
			id=Bryony
			message= _ "Let's run like the wind!"
		[/message]
		[message]
			speaker=narrator
			message= _ "Bryony gives all other units in your army +1 move!"
		[/message]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Bryony
    	[/not]
    	#Exclude Kirielle because when this event triggers she will have already been recalled
    	#Resulting in her being buffed twice which we don't want
    	[not]
    	id=Kirielle
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=movement
            increase=1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=bryony_happiness 
		less_than_equal_to=50
		[/variable]

		[then]
		[message]
			speaker=narrator
			message= _ "Bryony Unity Magic: 
						If happiness is >50, then +1 move.
						If happiness is >95, then +2 move.
						Current Bryony happiness is $bryony_happiness!
						Increase happiness levels to activate unity magic!"
		[/message]
		

		[/then]
	[/if]


		
[/event]	

[event]
	name=recruit
	first_time_only=no
	
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=95
		[/variable]
		[then]

    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=movement
            increase=2
        [/effect]
    [/object]

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=bryony_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
            apply_to=movement
            increase=1
        [/effect]
    [/object]

		[/then]
	[/if]


[/event]	

[event]
	name=recall
	first_time_only=no
	
	[filter]
       [not]
           find_in=units_already_quick_buffed
       [/not]
    [/filter]
    
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=95
		[/variable]
	[then]
    
    [unstore_unit] 
    	variable=unit 
    	find_vacant=no 
    [/unstore_unit]
    
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
            [not]
    		id=Bryony
    		[/not]
        [/filter]
       
        [effect]
            apply_to=movement
            increase=2
        [/effect]
    [/object]
    
    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
       
        variable=units_already_quick_buffed
        mode=append
        kill=no
    [/store_unit]

 	[/then]
    [/if]
    
    [if]
		[variable] 
		name=bryony_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=bryony_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

	[then]
    
    [unstore_unit] 
    	variable=unit 
    	find_vacant=no 
    [/unstore_unit]
    
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
            [not]
    		id=Bryony
    		[/not]
        [/filter]
       
        [effect]
            apply_to=movement
            increase=1   
        [/effect]
    [/object]
    
    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
       
        variable=units_already_quick_buffed
        mode=append
        kill=no
    [/store_unit]


	[/then]
	[/if]

    
[/event]


[event]
	name=victory
	
#This is for units that were recalled and affected by unity magic but...
#...the player chose to undo the recall, and the (now-buffed) unit got left on the recall roster.
#This recalls all the effected units at the scenario end so that the victory event debuffs can take place.

#Two problems: recalling from an array in a victory event crashes wesnoth. Game engine bug???
#One solution would be to buff everyone on the recall roster at level start, then debuff everyone on the roster at the victory event. BUT...
#Using x,y=recall,recall I cannot manipulate stats of units on the recall roster in the pregame.
#I'm sure it's a problem with the filter, as I can manipulate the stats for specific units...

#The following code is a hackey solution, but it seems to work. Edit: No it doesn't.
#We check each unit in the array to see if it's in play. 
#If it isn't in play then we unstore it, so it can be affected by the victory event debuff.
#Then we kill all units in the array in the recall roster to prevent a problem with duplicate units.

#The below code doesn't work. If both Aurelia and Bryony unity magic is activated it creates a problem...
#...in which the quick-buffed units are double debuffed for some reason.

#Also, units that were recalled and then killed will still be unstored at the victory event.
#This could be fixed by creating yet another array to track units that were recalled and then killed.
#Then when we do the unstore we could make sure that only living units were unstored.
#But this is moot until the above problem can be fixed.

#{FOREACH units_already_quick_buffed b}
#[if]
#	[have_unit]
#		id=$units_already_quick_buffed[$b].id
#	[/have_unit]
	
#	[then]
		#Do nothing
#	[/then]
#	[else]
#		[unstore_unit]
#			variable=units_already_quick_buffed[$b]
#			find_vacant=yes
#		[/unstore_unit]

#	[/else]
	
#[/if]
#{NEXT b}

#[kill]
#x,y=recall,recall
#[and]
#find_in=units_already_quick_buffed
#[/and]
#[/kill]



	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=95
		[/variable]
		[then]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Bryony
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=movement
            increase=-2
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
{CLEAR_VARIABLE units_already_quick_buffed}

		[/then]
	[/if]
	
	[if]
		[variable] 
		name=bryony_happiness 
		greater_than=50
		[/variable]
		[and]
		[variable] 
		name=bryony_happiness 
		less_than_equal_to=95
		[/variable]
		[/and]

		[then]
	[store_unit]
    [filter]
        side=1
        [not]
    	id=Bryony
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=movement
            increase=-1
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
{CLEAR_VARIABLE units_already_quick_buffed}

		[/then]
	[/if]
	
[/event]

#Kirielle's unity magic
[event]
	name=recruit
	first_time_only=no
	
	
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
[/event]

[event]
	name=recall
	first_time_only=no
	
	[filter]
       [not]
           find_in=units_already_ambush_buffed
       [/not]
    [/filter]
    
    [unstore_unit] 
    	variable=unit 
    	find_vacant=no 
    [/unstore_unit]
    
    [object]
        silent=yes
       
        [filter]
            id=$unit.id
            side=1
        [/filter]
       
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
       
        variable=units_already_ambush_buffed
        mode=append
        kill=no
    [/store_unit]
    
[/event]

#Here we give ambush to Aurelia and Hurlot with a fire event command in the initial cutscene
#It is done manually if the cutscene is skipped
 
[event]
	name=kirielle_initial_unity
	
	[object]
        silent=yes
       
        [filter]
            id=Hurlot
        [/filter]
       
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
    [object]
        silent=yes
       
        [filter]
            id=Aurelia
        [/filter]
       
        [effect]
		apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
    [/object]
    
[/event]

#It's very important this event comes after Aurelia and Bryony unity magic???
[event]
	name=victory
	
	[store_unit]
    [filter]
        side=1
        [not]
    	type=Elvish Ranger,Elvish Avenger
    	[/not]
    [/filter]
   
    kill=no
    variable=units
	[/store_unit]
	
	{FOREACH units i}
    [object]
        silent=yes
       
        [filter]
            id=$units[$i].id
        [/filter]
       
        [effect]
            apply_to=remove_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
        [/effect]
    [/object]
{NEXT i}

{CLEAR_VARIABLE units}
{CLEAR_VARIABLE units_already_ambush_buffed}
	
[/event]

[event]
        name=last breath
        [filter]
            id=Kirielle
        [/filter]
        [message]
            speaker=Kirielle
            message= _ "Damn, they got me!"
        [/message]
        [message]
            speaker=Bryony
            message= _ "KIRIELLE! No!!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]

[/event]

#########################################
#####MISC DEATH EVENTS AND TIME OVER#####
#########################################

[event]
        name=last breath
        [filter]
            id=Hurlot
        [/filter]
        [music]
        name=sad.ogg
        play_once=yes
    	[/music]
        [message]
            speaker=Hurlot
            message= _ "Argh! They're too strong!"
        [/message]
        [message]
            speaker=Bryony
            message= _ "Oh dear..."
        [/message]
        
        [set_variable]
		name=hurlot_dead
		value=1
		[/set_variable]   
        
[/event]

[event]
        name=last breath
        [filter]
            id=Celadine
        [/filter]
        [message]
            speaker=Celadine
            message= _ "I regret I'm no longer able to serve..."
        [/message]
        [message]
            speaker=Bryony
            message= _ "The leader of the Viridian Order, dead! What a loss!"
        [/message]
        [endlevel]
			result=defeat
		[/endlevel]

[/event]

[event]
name=time over
		[message]
        speaker=Kirielle
        message= _ "Damn it, we took too long! Enemy reinforcements have arrived and all is lost!"
        [/message]
        [endlevel]
			result=defeat
		[/endlevel]
[/event]

# Load death speeches
{~add-ons/Elvish_Dynasty/utils/deathspeeches.cfg}

#Load promotions
{~add-ons/Elvish_Dynasty/utils/promotions.cfg}


[/scenario]
